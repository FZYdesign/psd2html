<!DOCTYPE html>  <html> <head>   <title>main</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="ControlUI.class.html">                 ControlUI.class.coffee               </a>                                           <a class="source" href="DialogUI.class.html">                 DialogUI.class.coffee               </a>                                           <a class="source" href="WindowUI.class.html">                 WindowUI.class.coffee               </a>                                           <a class="source" href="core.html">                 core.coffee               </a>                                           <a class="source" href="include_libraries.html">                 include_libraries.coffee               </a>                                           <a class="source" href="main.html">                 main.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               main             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">$.level = </span><span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Global Settings</h2>

<p>単位をピクセルに</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">preferences.rulerUnits = </span><span class="nx">Units</span><span class="p">.</span><span class="nx">PIXELS</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Global Variables</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">originalWidth = </span><span class="mi">0</span>
<span class="nv">originalHeight = </span><span class="mi">0</span>
<span class="nv">currentWidth = </span><span class="mi">0</span>
<span class="nv">currentHeight = </span><span class="mi">0</span>
<span class="nv">boundsOffsetX = </span><span class="mi">0</span>
<span class="nv">boundsOffsetY = </span><span class="mi">0</span>
<span class="nv">pageWidth = </span><span class="mi">0</span>
<span class="nv">offsetX = </span><span class="mi">0</span>
<span class="nv">offsetY = </span><span class="mi">0</span>
<span class="nv">saveFolder = </span><span class="kc">null</span>
<span class="nv">nameCounter = </span><span class="mi">0</span>
<span class="nv">structures = </span><span class="p">[]</span>
<span class="nv">fileNames = </span><span class="p">{}</span> <span class="c1"># ファイル名重複対策</span>
<span class="nv">fileNameCounter = </span><span class="mi">0</span> <span class="c1"># ファイル名重複対策</span>
<span class="nv">startTime = </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Functions</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">getLayerPath = </span><span class="nf">(layer) -&gt;</span>
  <span class="nv">path = </span><span class="p">[]</span>
  <span class="nv">getLayerName = </span><span class="nf">(layer) -&gt;</span>
    <span class="nx">path</span><span class="p">.</span><span class="nx">push</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">name</span>
    <span class="k">if</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">parent</span>
      <span class="nx">getLayerName</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">parent</span>
    <span class="k">return</span>
  <span class="nx">getLayerName</span> <span class="nx">layer</span>
  <span class="nx">path</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
  <span class="nx">path</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
  <span class="nx">path</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
  <span class="nx">path</span><span class="p">.</span><span class="nx">reverse</span><span class="p">()</span>
  <span class="nb">encodeURI</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39;/&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>閉じる</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">close = </span><span class="nf">(showDialog = false) -&gt;</span>
  <span class="k">if</span> <span class="nx">showDialog</span>
    <span class="k">unless</span> <span class="nx">confirm</span> <span class="s">&#39;閉じてよろしいですか?&#39;</span>
      <span class="k">return</span>
  <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="nx">SaveOptions</span><span class="p">.</span><span class="nx">DONOTSAVECHANGES</span><span class="p">);</span>
  <span class="k">return</span>

<span class="nv">getBounds = </span><span class="nf">(layer) -&gt;</span>
  <span class="nv">bounds = </span><span class="nx">layer</span><span class="p">.</span><span class="nx">bounds</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nv">x: </span><span class="nb">parseInt</span> <span class="nx">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">10</span>
    <span class="nv">y: </span><span class="nb">parseInt</span> <span class="nx">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span>
    <span class="nv">x2: </span><span class="nb">parseInt</span> <span class="nx">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">10</span>
    <span class="nv">y2: </span><span class="nb">parseInt</span> <span class="nx">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">10</span>
  <span class="p">}</span>

<span class="nv">enlargeForSelect = </span><span class="nf">(layer) -&gt;</span>
  <span class="nv">bounds = </span><span class="nx">getBounds</span> <span class="nx">layer</span>
  <span class="k">if</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="nx">currentWidth</span> <span class="o">-=</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">x</span>
    <span class="nx">boundsOffsetX</span> <span class="o">+=</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">x</span>
    <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">resizeCanvas</span> <span class="nx">currentWidth</span><span class="p">,</span> <span class="nx">currentHeight</span><span class="p">,</span> <span class="nx">AnchorPosition</span><span class="p">.</span><span class="nx">TOPRIGHT</span>
  <span class="k">if</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="nx">currentHeight</span> <span class="o">-=</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">boundsOffsetY</span> <span class="o">+=</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">resizeCanvas</span> <span class="nx">currentWidth</span><span class="p">,</span> <span class="nx">currentHeight</span><span class="p">,</span> <span class="nx">AnchorPosition</span><span class="p">.</span><span class="nx">BOTTOMLEFT</span>
  <span class="k">if</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">x2</span> <span class="o">&gt;</span> <span class="nx">currentWidth</span> <span class="o">+</span> <span class="nx">boundsOffsetX</span>
    <span class="nx">currentWidth</span> <span class="o">+=</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">x2</span> <span class="o">+</span> <span class="nx">boundsOffsetX</span>
    <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">resizeCanvas</span> <span class="nx">currentWidth</span><span class="p">,</span> <span class="nx">currentHeight</span><span class="p">,</span> <span class="nx">AnchorPosition</span><span class="p">.</span><span class="nx">TOPLEFT</span>
  <span class="k">if</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">y2</span> <span class="o">&gt;</span> <span class="nx">currentHeight</span> <span class="o">+</span> <span class="nx">boundsOffsetY</span>
    <span class="nx">currentHeight</span> <span class="o">+=</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">y2</span> <span class="o">+</span> <span class="nx">boundsOffsetY</span>
    <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">resizeCanvas</span> <span class="nx">currentWidth</span><span class="p">,</span> <span class="nx">currentHeight</span><span class="p">,</span> <span class="nx">AnchorPosition</span><span class="p">.</span><span class="nx">TOPLEFT</span>
  <span class="k">return</span> <span class="nx">bounds</span>

<span class="nv">restoreDimension = </span><span class="nf">-&gt;</span>
  <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">resizeCanvas</span> <span class="nx">originalWidth</span> <span class="o">-</span> <span class="nx">boundsOffsetX</span><span class="p">,</span> <span class="nx">originalHeight</span> <span class="o">-</span> <span class="nx">boundsOffsetY</span><span class="p">,</span> <span class="nx">AnchorPosition</span><span class="p">.</span><span class="nx">TOPLEFT</span>
  <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">resizeCanvas</span> <span class="nx">originalWidth</span><span class="p">,</span> <span class="nx">originalHeight</span><span class="p">,</span> <span class="nx">AnchorPosition</span><span class="p">.</span><span class="nx">BOTTOMRIGHT</span>

<span class="nv">isSelect = </span><span class="nf">-&gt;</span>
  <span class="nv">flag = </span><span class="kc">true</span>
  <span class="nv">_level = </span><span class="nx">$</span><span class="p">.</span><span class="nx">level</span>
  <span class="nv">$.level = </span><span class="mi">0</span>
  <span class="k">try</span>
    <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="k">catch</span> <span class="nx">e</span>
    <span class="nv">$.level = </span><span class="nx">_level</span>
    <span class="k">return</span> <span class="nv">flag = </span><span class="kc">false</span>
  <span class="k">finally</span>
    <span class="nv">$.level = </span><span class="nx">_level</span>
    <span class="k">return</span> <span class="nx">flag</span>
  <span class="k">return</span>

<span class="nv">copy = </span><span class="nf">(layer) -&gt;</span>
  <span class="nv">bounds = </span><span class="nx">enlargeForSelect</span> <span class="nx">layer</span>
  <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">select</span> <span class="p">[</span>
    <span class="p">[</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>     <span class="nx">bounds</span><span class="p">.</span><span class="nx">y</span><span class="p">]</span>
    <span class="p">[</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">y</span><span class="p">]</span>
    <span class="p">[</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">[</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>     <span class="nx">bounds</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
  <span class="p">]</span>
  <span class="nv">fillTransparent = </span><span class="kc">false</span>
  <span class="k">unless</span> <span class="nx">isSelect</span><span class="p">()</span>
    <span class="nv">black = </span><span class="k">new</span> <span class="nx">SolidColor</span>
    <span class="nv">black.model = </span><span class="nx">ColorModel</span><span class="p">.</span><span class="nx">RGB</span>
    <span class="nv">black.red = </span><span class="mi">0</span>
    <span class="nv">black.green = </span><span class="mi">0</span>
    <span class="nv">black.blue = </span><span class="mi">0</span>
    <span class="nv">dot = </span><span class="nx">activeDocument</span><span class="p">.</span><span class="nx">artLayers</span><span class="p">.</span><span class="nx">add</span><span class="p">()</span>
    <span class="nv">activeDocument.activeLayer = </span><span class="nx">dot</span>
    <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">fill</span> <span class="nx">black</span><span class="p">,</span> <span class="nx">ColorBlendMode</span><span class="p">.</span><span class="nx">NORMAL</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="kc">false</span>
    <span class="nv">fillTransparent = </span><span class="kc">true</span>
  <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">deselect</span><span class="p">()</span>
  <span class="nx">selectAllLayers</span><span class="p">()</span>
  <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">select</span> <span class="p">[</span>
    <span class="p">[</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>  <span class="nx">bounds</span><span class="p">.</span><span class="nx">y</span><span class="p">]</span>
    <span class="p">[</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">x2</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">y</span><span class="p">]</span>
    <span class="p">[</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">x2</span><span class="p">,</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">y2</span><span class="p">]</span>
    <span class="p">[</span><span class="nx">bounds</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>  <span class="nx">bounds</span><span class="p">.</span><span class="nx">y2</span><span class="p">]</span>
  <span class="p">]</span>
  <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">copy</span> <span class="kc">true</span>
  <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">deselect</span><span class="p">()</span>
  <span class="nv">activeDocument.activeLayer = </span><span class="nx">layer</span>
  <span class="k">if</span> <span class="nx">dot</span>
    <span class="nx">dot</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
  <span class="nv">dot = </span><span class="kc">null</span>
  <span class="nx">fillTransparent</span>

<span class="nv">paste = </span><span class="nf">(doc, fillTransparent) -&gt;</span>
  <span class="nx">doc</span><span class="p">.</span><span class="nx">paste</span><span class="p">()</span>
  <span class="nv">layer = </span><span class="nx">activeDocument</span><span class="p">.</span><span class="nx">activeLayer</span>
  <span class="nx">layer</span><span class="p">.</span><span class="nx">translate</span> <span class="o">-</span><span class="nx">layer</span><span class="p">.</span><span class="nx">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="nx">layer</span><span class="p">.</span><span class="nx">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">if</span> <span class="nx">fillTransparent</span>
    <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">select</span> <span class="p">[</span>
      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span>
  <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">deselect</span><span class="p">();</span>
  <span class="nv">doc = </span><span class="kc">null</span>
  <span class="k">return</span>

<span class="nv">getMetrics = </span><span class="nf">(layer) -&gt;</span>
  <span class="nv">bounds = </span><span class="nx">getBounds</span> <span class="nx">layer</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nv">x: </span><span class="nx">bounds</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">boundsOffsetX</span> <span class="o">+</span> <span class="nx">offsetX</span>
    <span class="nv">y: </span><span class="nx">bounds</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">boundsOffsetY</span> <span class="o">+</span> <span class="nx">offsetY</span>
    <span class="nv">width: </span><span class="nx">bounds</span><span class="p">.</span><span class="nx">x2</span> <span class="o">-</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">x</span>
    <span class="nv">height: </span><span class="nx">bounds</span><span class="p">.</span><span class="nx">y2</span> <span class="o">-</span> <span class="nx">bounds</span><span class="p">.</span><span class="nx">y</span>
  <span class="p">}</span>

<span class="nv">createDocument = </span><span class="nf">(width, height, name) -&gt;</span>
  <span class="k">return</span> <span class="nx">documents</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">NewDocumentMode</span><span class="p">.</span><span class="nx">RGB</span><span class="p">,</span> <span class="nx">DocumentFill</span><span class="p">.</span><span class="nx">TRANSPARENT</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>抽出</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">extract = </span><span class="nf">(layer, extFlag, originalText = []) -&gt;</span>
  <span class="nv">name = </span><span class="nx">layer</span><span class="p">.</span><span class="nx">name</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>拡張子の分離</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nv">ext = </span><span class="nx">name</span><span class="p">.</span><span class="nx">match</span> <span class="sr">/(\.(?:jpe?g|gif|png))$/i</span>
    <span class="nv">ext = </span><span class="nx">ext</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nv">name = </span><span class="nx">name</span><span class="p">.</span><span class="nx">replace</span> <span class="nx">ext</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
  <span class="nv">ext = </span><span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">extFlag</span> <span class="k">if</span> <span class="nx">extFlag</span>
  <span class="nv">dir = </span><span class="nx">getLayerPath</span> <span class="nx">layer</span>
  <span class="nv">name = </span><span class="nx">name</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^[0-9]/</span><span class="p">,</span> <span class="s">&#39;image$0&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[^a-z0-9_\.:-]/gi</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="nx">name</span> <span class="o">is</span> <span class="s">&#39;image&#39;</span>
    <span class="nv">name = </span><span class="s">&#39;image_&#39;</span> <span class="o">+</span> <span class="nx">nameCounter</span><span class="o">++</span>
  <span class="k">if</span> <span class="nx">fileNames</span><span class="p">[</span><span class="nx">dir</span> <span class="o">+</span> <span class="nx">name</span><span class="p">]</span>
    <span class="nx">name</span> <span class="o">+=</span> <span class="nx">fileNameCounter</span><span class="o">++</span>
  <span class="nx">fileNames</span><span class="p">[</span><span class="nx">dir</span> <span class="o">+</span> <span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">on</span>
  <span class="nv">fillTransparent = </span><span class="nx">copy</span> <span class="nx">layer</span>
  <span class="nv">metrics = </span><span class="nx">getMetrics</span> <span class="nx">layer</span>
  <span class="nv">newDoc = </span><span class="nx">createDocument</span> <span class="nx">metrics</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">metrics</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">name</span>
  <span class="nx">paste</span> <span class="nx">newDoc</span><span class="p">,</span> <span class="nx">fillTransparent</span>
  <span class="k">switch</span> <span class="nx">ext</span>
    <span class="k">when</span> <span class="s">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s">&#39;jpeg&#39;</span>
      <span class="nv">url = </span><span class="nx">saveJPEG</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">dir</span>
    <span class="k">when</span> <span class="s">&#39;.gif&#39;</span>
      <span class="nv">url = </span><span class="nx">saveGIF</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">dir</span>
    <span class="k">else</span>
      <span class="nv">url = </span><span class="nx">savePNG</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">dir</span>
  <span class="nx">newDoc</span><span class="p">.</span><span class="nx">close</span> <span class="nx">SaveOptions</span><span class="p">.</span><span class="nx">DONOTSAVECHANGES</span>
  <span class="nv">data = </span><span class="nx">metrics</span>
  <span class="nv">data.name = </span><span class="nx">name</span>
  <span class="nv">data.url = </span><span class="nx">url</span>
  <span class="nv">data.text = </span><span class="nx">originalText</span>
  <span class="nx">structures</span><span class="p">.</span><span class="nx">push</span> <span class="nx">data</span>
  <span class="k">return</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>アウトプット</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">output = </span><span class="nf">(layers, ext) -&gt;</span>
  <span class="k">for</span> <span class="nx">layer</span> <span class="k">in</span> <span class="nx">layers</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>なにもしないレイヤー</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="sr">/^_:/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">layer</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
      <span class="k">continue</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>フォルダレイヤーであり、スマートオブジェクト化対象外の場合は子レイヤーを再帰処理する</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">layers</span> <span class="o">and</span> <span class="o">not</span> <span class="sr">/^o:/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">layer</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
      <span class="nx">output</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">layers</span><span class="p">,</span> <span class="nx">ext</span>
      <span class="nx">app</span><span class="p">.</span><span class="nx">purge</span><span class="p">(</span><span class="nx">PurgeTarget</span><span class="p">.</span><span class="nx">ALLCACHES</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">gc</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>スマートオブジェクト化対象のレイヤーをスマートオブジェクト化して抽出する</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">else</span>
      <span class="nx">do</span> <span class="nf">-&gt;</span>
        <span class="nv">layer.visible = </span><span class="kc">on</span>
        <span class="nv">newLayer = </span><span class="nx">cloneLayer</span> <span class="nx">layer</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>hideIgnoreLayers newLayer</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">newLayer = </span><span class="nx">toSmartObject</span> <span class="nx">newLayer</span>
        <span class="nv">layer.visible = </span><span class="kc">off</span>
        <span class="nv">newLayer.name = </span><span class="nx">newLayer</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">replace</span> <span class="sr">/^o:/</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
        <span class="nv">originalText = </span><span class="nx">getText</span> <span class="nx">layer</span>
        <span class="nx">extract</span> <span class="nx">newLayer</span><span class="p">,</span> <span class="nx">ext</span><span class="p">,</span> <span class="nx">originalText</span>
        <span class="nx">newLayer</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
        <span class="nv">newLayer = </span><span class="kc">null</span>
        <span class="nx">app</span><span class="p">.</span><span class="nx">purge</span><span class="p">(</span><span class="nx">PurgeTarget</span><span class="p">.</span><span class="nx">ALLCACHES</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">gc</span><span class="p">()</span>
  <span class="k">return</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h2>全レイヤーを非表示にする</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">hideAllLayers = </span><span class="nf">(layers, parentIsSmartObject) -&gt;</span>
  <span class="k">if</span> <span class="nx">layers</span>
    <span class="k">for</span> <span class="nx">layer</span> <span class="k">in</span> <span class="nx">layers</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>親レイヤーがスマートオブジェクト対象</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">parentIsSmartObject</span>
        <span class="k">if</span> <span class="sr">/^_:/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">layer</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
          <span class="nv">layer.visible = </span><span class="kc">off</span>
      <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>非表示</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">layer.visible = </span><span class="kc">off</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>再帰（フォルダレイヤー且つスマートオブジェクト化対象外→スマートオブジェクト化対象の中身は表示のまま）</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">isSmartObject = </span><span class="o">not</span> <span class="sr">/^o:/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">layer</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="o">or</span> <span class="nx">parentIsSmartObject</span>
      <span class="nx">hideAllLayers</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">layers</span><span class="p">,</span> <span class="nx">isSmartObject</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h2>exec</h2>

<p>実行</p>

<p>@param {Number} typeFlag 出力タイプ
@param {String} ext 拡張子 <br />
@param {String} saveFolderPath 出力パス <br />
@param {Boolean} mix 背景を含めるかどうか</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">exec = </span><span class="nf">(typeFlag, ext, saveFolderPath = &#39;~/&#39;, mix = false) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>タイマースタート</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">startTime = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>カンバスサイズをメモ</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">originalWidth = </span><span class="nx">activeDocument</span><span class="p">.</span><span class="nx">width</span>
  <span class="nv">originalHeight = </span><span class="nx">activeDocument</span><span class="p">.</span><span class="nx">height</span>
  <span class="nv">currentWidth = </span><span class="nx">originalWidth</span>
  <span class="nv">currentHeight = </span><span class="nx">originalHeight</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>フォルダインスタンス</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">saveFolder = </span><span class="k">new</span> <span class="nx">Folder</span> <span class="nx">saveFolderPath</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>全レイヤーを非表示にする</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">hideAllLayers</span> <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">layers</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p><strong>画像の出力</strong> レイヤーの数だけ再帰</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">output</span> <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">layers</span><span class="p">,</span> <span class="nx">ext</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <h3>カンバスサイズをもとに戻す</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">restoreDimension</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p><strong>ここまでが画像の出力</strong></p>

<hr />

<p>取得したレイヤーを逆にする</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">structures</span><span class="p">.</span><span class="nx">reverse</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h3>出力タイプにより出力</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">FLAG_CSS = </span><span class="mi">1</span>
  <span class="nv">FLAG_JSON = </span><span class="mi">2</span>
  <span class="nv">FLAG_LESS = </span><span class="mi">4</span>
  <span class="nv">FLAG_JQUERY = </span><span class="mi">8</span>
  <span class="nv">FLAG_JSFL = </span><span class="mi">16</span>
  <span class="k">if</span> <span class="nx">typeFlag</span> <span class="o">&amp;</span> <span class="nx">FLAG_CSS</span>
    <span class="nx">outputCSS</span> <span class="nx">structures</span>
  <span class="k">if</span> <span class="nx">typeFlag</span> <span class="o">&amp;</span> <span class="nx">FLAG_LESS</span>
    <span class="nx">outputLESS</span> <span class="nx">structures</span>
  <span class="k">if</span> <span class="nx">typeFlag</span> <span class="o">&amp;</span> <span class="nx">FLAG_JQUERY</span>
    <span class="nx">outputJQUERY</span> <span class="nx">structures</span>
  <span class="k">if</span> <span class="nx">typeFlag</span> <span class="o">&amp;</span> <span class="nx">FLAG_JSON</span>
    <span class="nx">outputJSON</span> <span class="nx">structures</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h3>完了</h3>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">endTime = </span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">)</span> <span class="o">-</span> <span class="nx">startTime</span>
  <span class="nv">period = </span><span class="nx">do</span> <span class="nf">-&gt;</span>
    <span class="nv">endTimeDate = </span><span class="k">new</span> <span class="nb">Date</span>

  <span class="k">if</span> <span class="nx">confirm</span> <span class="s">&#39;Complete!!\nお待たせしました。終了です。\nレイヤーの状態を元に戻しますか?&#39;</span>
    <span class="nx">revert</span><span class="p">()</span>
  <span class="k">return</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h2>入力ダイアログの表示</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">input = </span><span class="nf">-&gt;</span>
  <span class="nv">$dialog = </span><span class="k">new</span> <span class="nx">DialogUI</span> <span class="s">&#39;PSD to HTML&#39;</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nf">-&gt;</span>
    <span class="nx">@addText</span> <span class="s">&#39;書き出しフォルダ&#39;</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span>
    <span class="nv">$saveFolder = </span><span class="nx">@addTextbox</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span>
    <span class="nx">$saveFolder</span><span class="p">.</span><span class="nx">val</span> <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\.[a-z0-9_]+$/i</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span>
    <span class="nx">@addButton</span> <span class="s">&#39;選択&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span>
      <span class="nv">click: </span><span class="nf">-&gt;</span>
        <span class="nv">saveFolder = </span><span class="nx">Folder</span><span class="p">.</span><span class="nx">selectDialog</span> <span class="s">&#39;保存先のフォルダを選択してください&#39;</span>
        <span class="nx">$saveFolder</span><span class="p">.</span><span class="nx">val</span> <span class="nb">decodeURI</span> <span class="nx">saveFolder</span><span class="p">.</span><span class="nx">getRelativeURI</span> <span class="s">&#39;/&#39;</span> <span class="k">if</span> <span class="nx">saveFolder</span>
    <span class="nx">@addText</span> <span class="s">&#39;書き出し形式&#39;</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">160</span>
    <span class="nv">$types = </span><span class="p">[]</span>
    <span class="nx">$types</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@addCheckbox</span> <span class="s">&#39;HTML＆CSS&#39;</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="o">+</span><span class="mi">140</span><span class="o">*</span><span class="mi">0</span><span class="p">,</span> <span class="mi">190</span>
    <span class="nx">$types</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@addCheckbox</span> <span class="s">&#39;JSON&#39;</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="o">+</span><span class="mi">140</span><span class="o">*</span><span class="mi">1</span><span class="p">,</span> <span class="mi">190</span>
    <span class="nx">$types</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@addCheckbox</span> <span class="s">&#39;LESS＆SASS&#39;</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="o">+</span><span class="mi">140</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="mi">190</span>
    <span class="nx">$types</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@addCheckbox</span> <span class="s">&#39;jQuery&#39;</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="o">+</span><span class="mi">140</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="mi">190</span>
    <span class="nx">$types</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@addCheckbox</span> <span class="s">&#39;JSFL&#39;</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="o">+</span><span class="mi">140</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="mi">190</span>
    <span class="nx">@addText</span> <span class="s">&#39;オプション&#39;</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">230</span>
    <span class="nv">$mix = </span><span class="nx">@addCheckbox</span> <span class="s">&#39;背景やバウンディングボックスの範囲に入るオブジェクトも含めて書きだす。&#39;</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">260</span>
    <span class="nv">$png = </span><span class="nx">@addRadio</span> <span class="s">&#39;全ての画像を強制的にPNGで書き出す。&#39;</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">290</span>
    <span class="nv">$gif = </span><span class="nx">@addRadio</span> <span class="s">&#39;全ての画像を強制的にGIFで書き出す。&#39;</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">320</span>
    <span class="nx">@addText</span> <span class="s">&#39;ドキュメントの原点のオフセットX&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">350</span>
    <span class="nv">$offsetX = </span><span class="nx">@addTextbox</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">350</span>
    <span class="nx">$offsetX</span><span class="p">.</span><span class="nx">val</span> <span class="mi">0</span>
    <span class="nx">@addText</span> <span class="s">&#39;px&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">235</span><span class="p">,</span> <span class="mi">350</span>
    <span class="nx">@addText</span> <span class="s">&#39;ドキュメントの原点のオフセットY&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">310</span><span class="p">,</span> <span class="mi">350</span>
    <span class="nv">$offsetY = </span><span class="nx">@addTextbox</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">490</span><span class="p">,</span> <span class="mi">350</span>
    <span class="nx">$offsetY</span><span class="p">.</span><span class="nx">val</span> <span class="mi">0</span>
    <span class="nx">@addText</span> <span class="s">&#39;px&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">535</span><span class="p">,</span> <span class="mi">350</span>
    <span class="nx">@addText</span> <span class="s">&#39;ページの幅&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">380</span>
    <span class="nv">$pageWidth = </span><span class="nx">@addTextbox</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">380</span>
    <span class="nx">$pageWidth</span><span class="p">.</span><span class="nx">val</span> <span class="mi">0</span>
    <span class="nx">@addText</span> <span class="s">&#39;px&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">235</span><span class="p">,</span> <span class="mi">380</span>
    <span class="nx">@ok</span> <span class="nf">-&gt;</span>
      <span class="nv">saveFolderPath = </span><span class="nb">encodeURI</span> <span class="nx">$saveFolder</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
      <span class="nv">typeFlag = </span><span class="mi">0</span>
      <span class="k">for</span> <span class="nx">$type</span><span class="p">,</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">$types</span>
        <span class="k">if</span> <span class="nx">$type</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
          <span class="nx">typeFlag</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">i</span>
      <span class="nv">ext = </span><span class="s">&#39;png&#39;</span> <span class="k">if</span> <span class="nx">$png</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
      <span class="nv">ext = </span><span class="s">&#39;gif&#39;</span> <span class="k">if</span> <span class="nx">$gif</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
      <span class="nv">offsetX = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">$offsetX</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="o">or</span> <span class="mi">0</span>
      <span class="nv">offsetY = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">$offsetY</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="o">or</span> <span class="mi">0</span>
      <span class="nv">pageWidth = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">$pageWidth</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">or</span> <span class="mi">0</span>
      <span class="nx">@close</span><span class="p">()</span>
      <span class="nx">exec</span> <span class="nx">typeFlag</span><span class="p">,</span> <span class="nx">ext</span><span class="p">,</span> <span class="nx">saveFolderPath</span><span class="p">,</span> <span class="nx">$mix</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="c1"># 実行</span>

<span class="k">if</span> <span class="nx">documents</span><span class="p">.</span><span class="nx">length</span>
  <span class="nv">savable = </span><span class="kc">yes</span>
  <span class="nv">_level = </span><span class="nx">$</span><span class="p">.</span><span class="nx">level</span>
  <span class="nv">$.level = </span><span class="mi">0</span>
  <span class="k">try</span>
    <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">path</span>
  <span class="k">catch</span> <span class="nx">err</span>
    <span class="nx">alert</span> <span class="s">&#39;保存してください\nこのドキュメントは一度も保存されていません。\nドキュメントを保存後に再実行してください。&#39;</span>
    <span class="nv">savable = </span><span class="kc">no</span>
  <span class="nv">$.level = </span><span class="nx">_level</span>
  <span class="k">if</span> <span class="nx">savable</span>
    <span class="k">if</span> <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">saved</span>
      <span class="nx">input</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="k">if</span> <span class="nx">confirm</span> <span class="s">&#39;ドキュメントが保存されていません。\n保存しますか？&#39;</span>
        <span class="nx">activeDocument</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
      <span class="nx">input</span><span class="p">()</span>
<span class="k">else</span>
  <span class="nx">alert</span> <span class="s">&#39;ドキュメントが開かれていません\n対象のドキュメントが開かれていません。&#39;</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 